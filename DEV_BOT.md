# SmartSell Bot - Документация для разработчиков

## Принцип работы

SmartSell Bot — это автоматизированная система для применения изменений к файлам репозитория через комментарии в Pull Request'ах и Issues. Бот анализирует комментарии, ищет команды вида `/bot apply:` и выполняет соответствующие операции с файлами.

## Архитектура

### Основные компоненты:

1. **BotLogger** — система логирования всех операций бота
2. **InstructionParser** — парсер для извлечения инструкций из комментариев  
3. **FileProcessor** — процессор для применения изменений к файлам
4. **SmartSellBot** — основной класс, координирующий работу компонентов

### Процесс обработки:

```
Комментарий → Парсинг → Валидация → Применение → Логирование
```

## Поддерживаемые операции

- **SET**: Полная замена содержимого файла
- **APPEND**: Добавление содержимого в конец файла  
- **REPLACE**: Замена текста по регулярному выражению
- **PATCH**: Частичная замена строк

## Запуск и тестирование

### Локальный запуск:

```bash
# Тестовый режим
python .github/bot/apply.py --test

# Обработка комментария из файла
python .github/bot/apply.py --comment-file comment.txt

# Обработка комментария напрямую
python .github/bot/apply.py --comment "текст комментария"
```

### Параметры запуска:

- `--comment`: Текст комментария для обработки
- `--comment-file`: Файл с текстом комментария
- `--base-path`: Базовый путь для файлов (по умолчанию: текущая директория)
- `--log-file`: Файл для записи логов
- `--test`: Запуск в тестовом режиме с примерами

## Структура файлов

```
.github/
  bot/
    apply.py          # Основной скрипт бота
BOT_USAGE.md          # Подробная инструкция пользователя
DEV_BOT.md            # Этот файл - документация для разработчиков
```

## Интеграция с GitHub Actions

Бот предназначен для работы в составе GitHub Actions workflow при получении комментариев в PR/Issues. Пример интеграции смотрите в [BOT_USAGE.md](BOT_USAGE.md#интеграция-с-workflow).

## Безопасность и ограничения

- Работа только внутри репозитория
- Логирование всех операций
- Валидация входных данных
- Обработка ошибок без остановки процесса

## Расширение функциональности

Для добавления новых режимов операций:

1. Добавьте режим в `FileProcessor.SUPPORTED_MODES`
2. Реализуйте метод обработки в классе `FileProcessor`
3. Добавьте обработку в метод `apply_instruction`
4. Обновите документацию

## Подробная документация

Полное руководство по использованию см. в [BOT_USAGE.md](BOT_USAGE.md).